# üéõÔ∏è PSYCHO-NOIR KONTRAPUNKT SUPERVISOR CONFIGURATION üéõÔ∏è
# =============================================================
# 
# 100% robust process management med comprehensive monitoring.
# Proven patterns, automatic restart, comprehensive logging.
# 
# SUPERVISOR_SIGNATURE: 0xROBUST_PROCESS_ORCHESTRATION_ACTIVE
# MONITORING_LEVEL: ENTERPRISE_GRADE_SUPERVISION

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
loglevel=info

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# üåê Psycho-Noir API Service
[program:psychonoir-api]
command=/usr/local/bin/gunicorn --config /app/gunicorn.conf.py backend.python.psycho_noir_api:app
directory=/app
user=psychonoir
autostart=true
autorestart=true
startretries=3
startsecs=10
stopwaitsecs=10
redirect_stderr=true
stdout_logfile=/var/log/psychonoir/api.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=
    PYTHONPATH="/app",
    FLASK_ENV="production",
    LOG_LEVEL="INFO"

# üåê Portal Integration Service
[program:psychonoir-portal]
command=/usr/local/bin/python -m backend.python.psycho_noir_portal_integration
directory=/app
user=psychonoir
autostart=true
autorestart=true
startretries=3
startsecs=10
stopwaitsecs=10
redirect_stderr=true
stdout_logfile=/var/log/psychonoir/portal.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=
    PYTHONPATH="/app",
    FLASK_ENV="production",
    LOG_LEVEL="INFO"

# üîç System Monitor Service
[program:psychonoir-monitor]
command=/usr/local/bin/python /app/backend/python/system_monitor.py
directory=/app
user=psychonoir
autostart=true
autorestart=true
startretries=3
startsecs=5
stopwaitsecs=5
redirect_stderr=true
stdout_logfile=/var/log/psychonoir/monitor.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=3

# üåê Nginx Web Server
[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=3
startsecs=5
stopwaitsecs=5
redirect_stderr=true
stdout_logfile=/var/log/nginx/supervisor.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=3

# üìä Database Maintenance Service
[program:psychonoir-maintenance]
command=/usr/local/bin/python /app/backend/python/database_maintenance.py
directory=/app
user=psychonoir
autostart=true
autorestart=true
startretries=5
startsecs=30
stopwaitsecs=15
redirect_stderr=true
stdout_logfile=/var/log/psychonoir/maintenance.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=3

# üîê Log Rotation Service
[program:logrotate]
command=/usr/sbin/logrotate -f /etc/logrotate.d/psychonoir
autostart=false
autorestart=false
startsecs=0

# Group configuration for easy management
[group:psychonoir-core]
programs=psychonoir-api,psychonoir-portal
priority=100

[group:psychonoir-support]
programs=psychonoir-monitor,psychonoir-maintenance
priority=200

[group:infrastructure]
programs=nginx
priority=300

# Event listeners for advanced monitoring
[eventlistener:memmon]
command=/usr/local/bin/memmon -a 200MB -m system@psychonoir.local
events=TICK_60

[eventlistener:crashmail]
command=/usr/local/bin/crashmail -a -m admin@psychonoir.local
events=PROCESS_STATE_EXITED
